{"ast":null,"code":"'use strict';\n\nvar md5 = require('../lib/md5');\n\nvar CryptoJS = require('../lib/crypto');\n\nvar xml2json = require('../lib/xml2json');\n\nvar json2xml = require('../lib/json2xml');\n\nfunction camSafeUrlEncode(str) {\n  return encodeURIComponent(str).replace(/!/g, '%21').replace(/'/g, '%27').replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/\\*/g, '%2A');\n}\n\nfunction getObjectKeys(obj, forKey) {\n  var list = [];\n\n  for (var key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      list.push(forKey ? camSafeUrlEncode(key).toLowerCase() : key);\n    }\n  }\n\n  return list.sort(function (a, b) {\n    a = a.toLowerCase();\n    b = b.toLowerCase();\n    return a === b ? 0 : a > b ? 1 : -1;\n  });\n}\n\n;\n/**\n * obj转为string\n * @param  {Object}  obj                需要转的对象，必须\n * @param  {Boolean} lowerCaseKey       key是否转为小写，默认false，非必须\n * @return {String}  data               返回字符串\n */\n\nvar obj2str = function (obj, lowerCaseKey) {\n  var i, key, val;\n  var list = [];\n  var keyList = getObjectKeys(obj);\n\n  for (i = 0; i < keyList.length; i++) {\n    key = keyList[i];\n    val = obj[key] === undefined || obj[key] === null ? '' : '' + obj[key];\n    key = lowerCaseKey ? camSafeUrlEncode(key).toLowerCase() : camSafeUrlEncode(key);\n    val = camSafeUrlEncode(val) || '';\n    list.push(key + '=' + val);\n  }\n\n  return list.join('&');\n}; // 可以签入签名的headers\n\n\nvar signHeaders = ['content-disposition', 'content-encoding', 'content-length', 'content-md5', 'expect', 'host', 'if-match', 'if-modified-since', 'if-none-match', 'if-unmodified-since', 'origin', 'range', 'response-cache-control', 'response-content-disposition', 'response-content-encoding', 'response-content-language', 'response-content-type', 'response-expires', 'transfer-encoding', 'versionid'];\n\nvar getSignHeaderObj = function (headers) {\n  var signHeaderObj = {};\n\n  for (var i in headers) {\n    var key = i.toLowerCase();\n\n    if (key.indexOf('x-cos-') > -1 || signHeaders.indexOf(key) > -1) {\n      signHeaderObj[i] = headers[i];\n    }\n  }\n\n  return signHeaderObj;\n}; //测试用的key后面可以去掉\n\n\nvar getAuth = function (opt) {\n  opt = opt || {};\n  var SecretId = opt.SecretId;\n  var SecretKey = opt.SecretKey;\n  var KeyTime = opt.KeyTime;\n  var method = (opt.method || opt.Method || 'get').toLowerCase();\n  var queryParams = clone(opt.Query || opt.params || {});\n  var headers = getSignHeaderObj(clone(opt.Headers || opt.headers || {}));\n  var Key = opt.Key || '';\n  var pathname;\n\n  if (opt.UseRawKey) {\n    pathname = opt.Pathname || opt.pathname || '/' + Key;\n  } else {\n    pathname = opt.Pathname || opt.pathname || Key;\n    pathname.indexOf('/') !== 0 && (pathname = '/' + pathname);\n  } // 如果有传入存储桶，那么签名默认加 Host 参与计算，避免跨桶访问\n\n\n  if (!headers.Host && !headers.host && opt.Bucket && opt.Region) headers.Host = opt.Bucket + '.cos.' + opt.Region + '.myqcloud.com';\n  if (!SecretId) throw new Error('missing param SecretId');\n  if (!SecretKey) throw new Error('missing param SecretKey'); // 签名有效起止时间\n\n  var now = Math.round(getSkewTime(opt.SystemClockOffset) / 1000) - 1;\n  var exp = now;\n  var Expires = opt.Expires || opt.expires;\n\n  if (Expires === undefined) {\n    exp += 900; // 签名过期时间为当前 + 900s\n  } else {\n    exp += Expires * 1 || 0;\n  } // 要用到的 Authorization 参数列表\n\n\n  var qSignAlgorithm = 'sha1';\n  var qAk = SecretId;\n  var qSignTime = KeyTime || now + ';' + exp;\n  var qKeyTime = KeyTime || now + ';' + exp;\n  var qHeaderList = getObjectKeys(headers, true).join(';').toLowerCase();\n  var qUrlParamList = getObjectKeys(queryParams, true).join(';').toLowerCase(); // 签名算法说明文档：https://www.qcloud.com/document/product/436/7778\n  // 步骤一：计算 SignKey\n\n  var signKey = CryptoJS.HmacSHA1(qKeyTime, SecretKey).toString(); // 步骤二：构成 FormatString\n\n  var formatString = [method, pathname, util.obj2str(queryParams, true), util.obj2str(headers, true), ''].join('\\n'); // 步骤三：计算 StringToSign\n\n  var stringToSign = ['sha1', qSignTime, CryptoJS.SHA1(formatString).toString(), ''].join('\\n'); // 步骤四：计算 Signature\n\n  var qSignature = CryptoJS.HmacSHA1(stringToSign, signKey).toString(); // 步骤五：构造 Authorization\n\n  var authorization = ['q-sign-algorithm=' + qSignAlgorithm, 'q-ak=' + qAk, 'q-sign-time=' + qSignTime, 'q-key-time=' + qKeyTime, 'q-header-list=' + qHeaderList, 'q-url-param-list=' + qUrlParamList, 'q-signature=' + qSignature].join('&');\n  return authorization;\n};\n\nvar readIntBE = function (chunk, size, offset) {\n  var bytes = size / 8;\n  var buf = chunk.slice(offset, offset + bytes);\n  new Uint8Array(buf).reverse();\n  return new {\n    8: Uint8Array,\n    16: Uint16Array,\n    32: Uint32Array\n  }[size](buf)[0];\n};\n\nvar buf2str = function (chunk, start, end, isUtf8) {\n  var buf = chunk.slice(start, end);\n  var str = '';\n  new Uint8Array(buf).forEach(function (charCode) {\n    str += String.fromCharCode(charCode);\n  });\n  if (isUtf8) str = decodeURIComponent(escape(str));\n  return str;\n};\n\nvar parseSelectPayload = function (chunk) {\n  var header = {};\n  var body = buf2str(chunk);\n  var result = {\n    records: []\n  };\n\n  while (chunk.byteLength) {\n    var totalLength = readIntBE(chunk, 32, 0);\n    var headerLength = readIntBE(chunk, 32, 4);\n    var payloadRestLength = totalLength - headerLength - 16;\n    var offset = 0;\n    var content;\n    chunk = chunk.slice(12); // 获取 Message 的 header 信息\n\n    while (offset < headerLength) {\n      var headerNameLength = readIntBE(chunk, 8, offset);\n      var headerName = buf2str(chunk, offset + 1, offset + 1 + headerNameLength);\n      var headerValueLength = readIntBE(chunk, 16, offset + headerNameLength + 2);\n      var headerValue = buf2str(chunk, offset + headerNameLength + 4, offset + headerNameLength + 4 + headerValueLength);\n      header[headerName] = headerValue;\n      offset += headerNameLength + 4 + headerValueLength;\n    }\n\n    if (header[':event-type'] === 'Records') {\n      content = buf2str(chunk, offset, offset + payloadRestLength, true);\n      result.records.push(content);\n    } else if (header[':event-type'] === 'Stats') {\n      content = buf2str(chunk, offset, offset + payloadRestLength, true);\n      result.stats = util.xml2json(content).Stats;\n    } else if (header[':event-type'] === 'error') {\n      var errCode = header[':error-code'];\n      var errMessage = header[':error-message'];\n      var err = new Error(errMessage);\n      err.message = errMessage;\n      err.name = err.code = errCode;\n      result.error = err;\n    } else if (['Progress', 'Continuation', 'End'].includes(header[':event-type'])) {// do nothing\n    }\n\n    chunk = chunk.slice(offset + payloadRestLength + 4);\n  }\n\n  return {\n    payload: result.records.join(''),\n    body: body\n  };\n};\n\nvar getSourceParams = function (source) {\n  var parser = this.options.CopySourceParser;\n  if (parser) return parser(source);\n  var m = source.match(/^([^.]+-\\d+)\\.cos(v6|-cdc)?\\.([^.]+)\\.myqcloud\\.com\\/(.+)$/);\n  if (!m) return null;\n  return {\n    Bucket: m[1],\n    Region: m[3],\n    Key: m[4]\n  };\n};\n\nvar noop = function () {}; // 清除对象里值为的 undefined 或 null 的属性\n\n\nvar clearKey = function (obj) {\n  var retObj = {};\n\n  for (var key in obj) {\n    if (obj.hasOwnProperty(key) && obj[key] !== undefined && obj[key] !== null) {\n      retObj[key] = obj[key];\n    }\n  }\n\n  return retObj;\n};\n\nvar readAsBinaryString = function (blob, callback) {\n  var readFun;\n  var fr = new FileReader();\n\n  if (FileReader.prototype.readAsBinaryString) {\n    readFun = FileReader.prototype.readAsBinaryString;\n\n    fr.onload = function () {\n      callback(this.result);\n    };\n  } else if (FileReader.prototype.readAsArrayBuffer) {\n    // 在 ie11 添加 readAsBinaryString 兼容\n    readFun = function (fileData) {\n      var binary = \"\";\n      var pt = this;\n      var reader = new FileReader();\n\n      reader.onload = function (e) {\n        var bytes = new Uint8Array(reader.result);\n        var length = bytes.byteLength;\n\n        for (var i = 0; i < length; i++) {\n          binary += String.fromCharCode(bytes[i]);\n        }\n\n        callback(binary);\n      };\n\n      reader.readAsArrayBuffer(fileData);\n    };\n  } else {\n    console.error('FileReader not support readAsBinaryString');\n  }\n\n  readFun.call(fr, blob);\n};\n\nvar fileSliceNeedCopy = function () {\n  var compareVersion = function (a, b) {\n    a = a.split('.');\n    b = b.split('.');\n\n    for (var i = 0; i < b.length; i++) {\n      if (a[i] !== b[i]) {\n        return parseInt(a[i]) > parseInt(b[i]) ? 1 : -1;\n      }\n    }\n\n    return 0;\n  };\n\n  var check = function (ua) {\n    if (!ua) return false;\n    var ChromeVersion = (ua.match(/Chrome\\/([.\\d]+)/) || [])[1];\n    var QBCoreVersion = (ua.match(/QBCore\\/([.\\d]+)/) || [])[1];\n    var QQBrowserVersion = (ua.match(/QQBrowser\\/([.\\d]+)/) || [])[1];\n    var need = ChromeVersion && compareVersion(ChromeVersion, '53.0.2785.116') < 0 && QBCoreVersion && compareVersion(QBCoreVersion, '3.53.991.400') < 0 && QQBrowserVersion && compareVersion(QQBrowserVersion, '9.0.2524.400') <= 0 || false;\n    return need;\n  };\n\n  return check(typeof navigator !== 'undefined' && navigator.userAgent);\n}(); // 获取文件分片\n\n\nvar fileSlice = function (file, start, end, isUseToUpload, callback) {\n  var blob;\n\n  if (file.slice) {\n    blob = file.slice(start, end);\n  } else if (file.mozSlice) {\n    blob = file.mozSlice(start, end);\n  } else if (file.webkitSlice) {\n    blob = file.webkitSlice(start, end);\n  }\n\n  if (isUseToUpload && fileSliceNeedCopy) {\n    var reader = new FileReader();\n\n    reader.onload = function (e) {\n      blob = null;\n      callback(new Blob([reader.result]));\n    };\n\n    reader.readAsArrayBuffer(blob);\n  } else {\n    callback(blob);\n  }\n}; // 获取文件内容的 MD5\n\n\nvar getBodyMd5 = function (UploadCheckContentMd5, Body, callback, onProgress) {\n  callback = callback || noop;\n\n  if (UploadCheckContentMd5) {\n    if (typeof Body === 'string') {\n      callback(util.md5(Body, true));\n    } else if (Blob && Body instanceof Blob) {\n      util.getFileMd5(Body, function (err, md5) {\n        callback(md5);\n      }, onProgress);\n    } else {\n      callback();\n    }\n  } else {\n    callback();\n  }\n}; // 获取文件 md5 值\n\n\nvar md5ChunkSize = 1024 * 1024;\n\nvar getFileMd5 = function (blob, callback, onProgress) {\n  var size = blob.size;\n  var loaded = 0;\n  var md5ctx = md5.getCtx();\n\n  var next = function (start) {\n    if (start >= size) {\n      var hash = md5ctx.digest('hex');\n      callback(null, hash);\n      return;\n    }\n\n    var end = Math.min(size, start + md5ChunkSize);\n    util.fileSlice(blob, start, end, false, function (chunk) {\n      readAsBinaryString(chunk, function (content) {\n        chunk = null;\n        md5ctx = md5ctx.update(content, true);\n        loaded += content.length;\n        content = null;\n        if (onProgress) onProgress({\n          loaded: loaded,\n          total: size,\n          percent: Math.round(loaded / size * 10000) / 10000\n        });\n        next(start + md5ChunkSize);\n      });\n    });\n  };\n\n  next(0);\n};\n\nfunction clone(obj) {\n  return map(obj, function (v) {\n    return typeof v === 'object' && v !== null ? clone(v) : v;\n  });\n}\n\nfunction attr(obj, name, defaultValue) {\n  return obj && name in obj ? obj[name] : defaultValue;\n}\n\nfunction extend(target, source) {\n  each(source, function (val, key) {\n    target[key] = source[key];\n  });\n  return target;\n}\n\nfunction isArray(arr) {\n  return arr instanceof Array;\n}\n\nfunction isInArray(arr, item) {\n  var flag = false;\n\n  for (var i = 0; i < arr.length; i++) {\n    if (item === arr[i]) {\n      flag = true;\n      break;\n    }\n  }\n\n  return flag;\n}\n\nfunction makeArray(arr) {\n  return isArray(arr) ? arr : [arr];\n}\n\nfunction each(obj, fn) {\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      fn(obj[i], i);\n    }\n  }\n}\n\nfunction map(obj, fn) {\n  var o = isArray(obj) ? [] : {};\n\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      o[i] = fn(obj[i], i);\n    }\n  }\n\n  return o;\n}\n\nfunction filter(obj, fn) {\n  var iaArr = isArray(obj);\n  var o = iaArr ? [] : {};\n\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (fn(obj[i], i)) {\n        if (iaArr) {\n          o.push(obj[i]);\n        } else {\n          o[i] = obj[i];\n        }\n      }\n    }\n  }\n\n  return o;\n}\n\nvar binaryBase64 = function (str) {\n  var i,\n      len,\n      char,\n      res = '';\n\n  for (i = 0, len = str.length / 2; i < len; i++) {\n    char = parseInt(str[i * 2] + str[i * 2 + 1], 16);\n    res += String.fromCharCode(char);\n  }\n\n  return btoa(res);\n};\n\nvar uuid = function () {\n  var S4 = function () {\n    return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);\n  };\n\n  return S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4();\n};\n\nvar hasMissingParams = function (apiName, params) {\n  var Bucket = params.Bucket;\n  var Region = params.Region;\n  var Key = params.Key;\n  var Domain = this.options.Domain;\n  var checkBucket = !Domain || Domain.indexOf('{Bucket}') > -1;\n  var checkRegion = !Domain || Domain.indexOf('{Region}') > -1;\n\n  if (apiName.indexOf('Bucket') > -1 || apiName === 'deleteMultipleObject' || apiName === 'multipartList' || apiName === 'listObjectVersions') {\n    if (checkBucket && !Bucket) return 'Bucket';\n    if (checkRegion && !Region) return 'Region';\n  } else if (apiName.indexOf('Object') > -1 || apiName.indexOf('multipart') > -1 || apiName === 'sliceUploadFile' || apiName === 'abortUploadTask') {\n    if (checkBucket && !Bucket) return 'Bucket';\n    if (checkRegion && !Region) return 'Region';\n    if (!Key) return 'Key';\n  }\n\n  return false;\n};\n\nvar formatParams = function (apiName, params) {\n  // 复制参数对象\n  params = extend({}, params); // 统一处理 Headers\n\n  if (apiName !== 'getAuth' && apiName !== 'getV4Auth' && apiName !== 'getObjectUrl') {\n    var Headers = params.Headers || {};\n\n    if (params && typeof params === 'object') {\n      (function () {\n        for (var key in params) {\n          if (params.hasOwnProperty(key) && key.indexOf('x-cos-') > -1) {\n            Headers[key] = params[key];\n          }\n        }\n      })();\n\n      var headerMap = {\n        // params headers\n        'x-cos-mfa': 'MFA',\n        'Content-MD5': 'ContentMD5',\n        'Content-Length': 'ContentLength',\n        'Content-Type': 'ContentType',\n        'Expect': 'Expect',\n        'Expires': 'Expires',\n        'Cache-Control': 'CacheControl',\n        'Content-Disposition': 'ContentDisposition',\n        'Content-Encoding': 'ContentEncoding',\n        'Range': 'Range',\n        'If-Modified-Since': 'IfModifiedSince',\n        'If-Unmodified-Since': 'IfUnmodifiedSince',\n        'If-Match': 'IfMatch',\n        'If-None-Match': 'IfNoneMatch',\n        'x-cos-copy-source': 'CopySource',\n        'x-cos-copy-source-Range': 'CopySourceRange',\n        'x-cos-metadata-directive': 'MetadataDirective',\n        'x-cos-copy-source-If-Modified-Since': 'CopySourceIfModifiedSince',\n        'x-cos-copy-source-If-Unmodified-Since': 'CopySourceIfUnmodifiedSince',\n        'x-cos-copy-source-If-Match': 'CopySourceIfMatch',\n        'x-cos-copy-source-If-None-Match': 'CopySourceIfNoneMatch',\n        'x-cos-acl': 'ACL',\n        'x-cos-grant-read': 'GrantRead',\n        'x-cos-grant-write': 'GrantWrite',\n        'x-cos-grant-full-control': 'GrantFullControl',\n        'x-cos-grant-read-acp': 'GrantReadAcp',\n        'x-cos-grant-write-acp': 'GrantWriteAcp',\n        'x-cos-storage-class': 'StorageClass',\n        'x-cos-traffic-limit': 'TrafficLimit',\n        'x-cos-mime-limit': 'MimeLimit',\n        // SSE-C\n        'x-cos-server-side-encryption-customer-algorithm': 'SSECustomerAlgorithm',\n        'x-cos-server-side-encryption-customer-key': 'SSECustomerKey',\n        'x-cos-server-side-encryption-customer-key-MD5': 'SSECustomerKeyMD5',\n        // SSE-COS、SSE-KMS\n        'x-cos-server-side-encryption': 'ServerSideEncryption',\n        'x-cos-server-side-encryption-cos-kms-key-id': 'SSEKMSKeyId',\n        'x-cos-server-side-encryption-context': 'SSEContext'\n      };\n      util.each(headerMap, function (paramKey, headerKey) {\n        if (params[paramKey] !== undefined) {\n          Headers[headerKey] = params[paramKey];\n        }\n      });\n      params.Headers = clearKey(Headers);\n    }\n  }\n\n  return params;\n};\n\nvar apiWrapper = function (apiName, apiFn) {\n  return function (params, callback) {\n    var self = this; // 处理参数\n\n    if (typeof params === 'function') {\n      callback = params;\n      params = {};\n    } // 整理参数格式\n\n\n    params = formatParams(apiName, params); // 代理回调函数\n\n    var formatResult = function (result) {\n      if (result && result.headers) {\n        result.headers['x-cos-request-id'] && (result.RequestId = result.headers['x-cos-request-id']);\n        result.headers['x-cos-version-id'] && (result.VersionId = result.headers['x-cos-version-id']);\n        result.headers['x-cos-delete-marker'] && (result.DeleteMarker = result.headers['x-cos-delete-marker']);\n      }\n\n      return result;\n    };\n\n    var _callback = function (err, data) {\n      callback && callback(formatResult(err), formatResult(data));\n    };\n\n    var checkParams = function () {\n      if (apiName !== 'getService' && apiName !== 'abortUploadTask') {\n        // 判断参数是否完整\n        var missingResult = hasMissingParams.call(self, apiName, params);\n\n        if (missingResult) {\n          return 'missing param ' + missingResult;\n        } // 判断 region 格式\n\n\n        if (params.Region) {\n          if (self.options.CompatibilityMode) {\n            if (!/^([a-z\\d-.]+)$/.test(params.Region)) {\n              return 'Region format error.';\n            }\n          } else {\n            if (params.Region.indexOf('cos.') > -1) {\n              return 'param Region should not be start with \"cos.\"';\n            } else if (!/^([a-z\\d-]+)$/.test(params.Region)) {\n              return 'Region format error.';\n            }\n          } // 判断 region 格式\n\n\n          if (!self.options.CompatibilityMode && params.Region.indexOf('-') === -1 && params.Region !== 'yfb' && params.Region !== 'default' && params.Region !== 'accelerate') {\n            console.warn('warning: param Region format error, find help here: https://cloud.tencent.com/document/product/436/6224');\n          }\n        } // 兼容不带 AppId 的 Bucket\n\n\n        if (params.Bucket) {\n          if (!/^([a-z\\d-]+)-(\\d+)$/.test(params.Bucket)) {\n            if (params.AppId) {\n              params.Bucket = params.Bucket + '-' + params.AppId;\n            } else if (self.options.AppId) {\n              params.Bucket = params.Bucket + '-' + self.options.AppId;\n            } else {\n              return 'Bucket should format as \"test-1250000000\".';\n            }\n          }\n\n          if (params.AppId) {\n            console.warn('warning: AppId has been deprecated, Please put it at the end of parameter Bucket(E.g Bucket:\"test-1250000000\" ).');\n            delete params.AppId;\n          }\n        } // 如果 Key 是 / 开头，强制去掉第一个 /\n\n\n        if (!self.options.UseRawKey && params.Key && params.Key.substr(0, 1) === '/') {\n          params.Key = params.Key.substr(1);\n        }\n      }\n    };\n\n    var errMsg = checkParams();\n    var isSync = apiName === 'getAuth' || apiName === 'getObjectUrl';\n\n    if (window.Promise && !isSync && !callback) {\n      return new Promise(function (resolve, reject) {\n        callback = function (err, data) {\n          err ? reject(err) : resolve(data);\n        };\n\n        if (errMsg) return _callback(util.error(new Error(errMsg)));\n        apiFn.call(self, params, _callback);\n      });\n    } else {\n      if (errMsg) return _callback(util.error(new Error(errMsg)));\n      var res = apiFn.call(self, params, _callback);\n      if (isSync) return res;\n    }\n  };\n};\n\nvar throttleOnProgress = function (total, onProgress) {\n  var self = this;\n  var size0 = 0;\n  var size1 = 0;\n  var time0 = Date.now();\n  var time1;\n  var timer;\n\n  function update() {\n    timer = 0;\n\n    if (onProgress && typeof onProgress === 'function') {\n      time1 = Date.now();\n      var speed = Math.max(0, Math.round((size1 - size0) / ((time1 - time0) / 1000) * 100) / 100) || 0;\n      var percent;\n\n      if (size1 === 0 && total === 0) {\n        percent = 1;\n      } else {\n        percent = Math.floor(size1 / total * 100) / 100 || 0;\n      }\n\n      time0 = time1;\n      size0 = size1;\n\n      try {\n        onProgress({\n          loaded: size1,\n          total: total,\n          speed: speed,\n          percent: percent\n        });\n      } catch (e) {}\n    }\n  }\n\n  return function (info, immediately) {\n    if (info) {\n      size1 = info.loaded;\n      total = info.total;\n    }\n\n    if (immediately) {\n      clearTimeout(timer);\n      update();\n    } else {\n      if (timer) return;\n      timer = setTimeout(update, self.options.ProgressInterval);\n    }\n  };\n};\n\nvar getFileSize = function (api, params, callback) {\n  var size;\n\n  if (typeof params.Body === 'string') {\n    params.Body = new Blob([params.Body], {\n      type: 'text/plain'\n    });\n  } else if (params.Body instanceof ArrayBuffer) {\n    params.Body = new Blob([params.Body]);\n  }\n\n  if (params.Body && (params.Body instanceof Blob || params.Body.toString() === '[object File]' || params.Body.toString() === '[object Blob]')) {\n    size = params.Body.size;\n  } else {\n    callback(util.error(new Error('params body format error, Only allow File|Blob|String.')));\n    return;\n  }\n\n  params.ContentLength = size;\n  callback(null, size);\n}; // 获取调正的时间戳\n\n\nvar getSkewTime = function (offset) {\n  return Date.now() + (offset || 0);\n};\n\nvar error = function (err, opt) {\n  var sourceErr = err;\n  err.message = err.message || null;\n\n  if (typeof opt === 'string') {\n    err.error = opt;\n    err.message = opt;\n  } else if (typeof opt === 'object' && opt !== null) {\n    extend(err, opt);\n    if (opt.code || opt.name) err.code = opt.code || opt.name;\n    if (opt.message) err.message = opt.message;\n    if (opt.stack) err.stack = opt.stack;\n  }\n\n  if (typeof Object.defineProperty === 'function') {\n    Object.defineProperty(err, 'name', {\n      writable: true,\n      enumerable: false\n    });\n    Object.defineProperty(err, 'message', {\n      enumerable: true\n    });\n  }\n\n  err.name = opt && opt.name || err.name || err.code || 'Error';\n  if (!err.code) err.code = err.name;\n  if (!err.error) err.error = clone(sourceErr); // 兼容老的错误格式\n\n  return err;\n};\n\nvar isNode = function () {\n  return typeof window !== 'object' && typeof process === 'object' && typeof require === 'function';\n};\n\nvar isCIHost = function (url) {\n  return /^https?:\\/\\/([^/]+\\.)?ci\\.[^/]+/.test(url);\n};\n\nvar util = {\n  noop: noop,\n  formatParams: formatParams,\n  apiWrapper: apiWrapper,\n  xml2json: xml2json,\n  json2xml: json2xml,\n  md5: md5,\n  clearKey: clearKey,\n  fileSlice: fileSlice,\n  getBodyMd5: getBodyMd5,\n  getFileMd5: getFileMd5,\n  binaryBase64: binaryBase64,\n  extend: extend,\n  isArray: isArray,\n  isInArray: isInArray,\n  makeArray: makeArray,\n  each: each,\n  map: map,\n  filter: filter,\n  clone: clone,\n  attr: attr,\n  uuid: uuid,\n  camSafeUrlEncode: camSafeUrlEncode,\n  throttleOnProgress: throttleOnProgress,\n  getFileSize: getFileSize,\n  getSkewTime: getSkewTime,\n  error: error,\n  obj2str: obj2str,\n  getAuth: getAuth,\n  parseSelectPayload: parseSelectPayload,\n  getSourceParams: getSourceParams,\n  isBrowser: true,\n  isNode: isNode,\n  isCIHost: isCIHost\n};\nmodule.exports = util;","map":{"version":3,"names":["md5","require","CryptoJS","xml2json","json2xml","camSafeUrlEncode","str","encodeURIComponent","replace","getObjectKeys","obj","forKey","list","key","hasOwnProperty","push","toLowerCase","sort","a","b","obj2str","lowerCaseKey","i","val","keyList","length","undefined","join","signHeaders","getSignHeaderObj","headers","signHeaderObj","indexOf","getAuth","opt","SecretId","SecretKey","KeyTime","method","Method","queryParams","clone","Query","params","Headers","Key","pathname","UseRawKey","Pathname","Host","host","Bucket","Region","Error","now","Math","round","getSkewTime","SystemClockOffset","exp","Expires","expires","qSignAlgorithm","qAk","qSignTime","qKeyTime","qHeaderList","qUrlParamList","signKey","HmacSHA1","toString","formatString","util","stringToSign","SHA1","qSignature","authorization","readIntBE","chunk","size","offset","bytes","buf","slice","Uint8Array","reverse","Uint16Array","Uint32Array","buf2str","start","end","isUtf8","forEach","charCode","String","fromCharCode","decodeURIComponent","escape","parseSelectPayload","header","body","result","records","byteLength","totalLength","headerLength","payloadRestLength","content","headerNameLength","headerName","headerValueLength","headerValue","stats","Stats","errCode","errMessage","err","message","name","code","error","includes","payload","getSourceParams","source","parser","options","CopySourceParser","m","match","noop","clearKey","retObj","readAsBinaryString","blob","callback","readFun","fr","FileReader","prototype","onload","readAsArrayBuffer","fileData","binary","pt","reader","e","console","call","fileSliceNeedCopy","compareVersion","split","parseInt","check","ua","ChromeVersion","QBCoreVersion","QQBrowserVersion","need","navigator","userAgent","fileSlice","file","isUseToUpload","mozSlice","webkitSlice","Blob","getBodyMd5","UploadCheckContentMd5","Body","onProgress","getFileMd5","md5ChunkSize","loaded","md5ctx","getCtx","next","hash","digest","min","update","total","percent","map","v","attr","defaultValue","extend","target","each","isArray","arr","Array","isInArray","item","flag","makeArray","fn","o","filter","iaArr","binaryBase64","len","char","res","btoa","uuid","S4","random","substring","hasMissingParams","apiName","Domain","checkBucket","checkRegion","formatParams","headerMap","paramKey","headerKey","apiWrapper","apiFn","self","formatResult","RequestId","VersionId","DeleteMarker","_callback","data","checkParams","missingResult","CompatibilityMode","test","warn","AppId","substr","errMsg","isSync","window","Promise","resolve","reject","throttleOnProgress","size0","size1","time0","Date","time1","timer","speed","max","floor","info","immediately","clearTimeout","setTimeout","ProgressInterval","getFileSize","api","type","ArrayBuffer","ContentLength","sourceErr","stack","Object","defineProperty","writable","enumerable","isNode","process","isCIHost","url","isBrowser","module","exports"],"sources":["/Users/yzbaoo/Desktop/huohua/ilc-web-packages/node_modules/cos-js-sdk-v5/src/util.js"],"sourcesContent":["'use strict';\n\nvar md5 = require('../lib/md5');\nvar CryptoJS = require('../lib/crypto');\nvar xml2json = require('../lib/xml2json');\nvar json2xml = require('../lib/json2xml');\n\nfunction camSafeUrlEncode(str) {\n    return encodeURIComponent(str)\n        .replace(/!/g, '%21')\n        .replace(/'/g, '%27')\n        .replace(/\\(/g, '%28')\n        .replace(/\\)/g, '%29')\n        .replace(/\\*/g, '%2A');\n}\n\nfunction getObjectKeys(obj, forKey) {\n    var list = [];\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            list.push(forKey ? camSafeUrlEncode(key).toLowerCase() : key);\n        }\n    }\n    return list.sort(function (a, b) {\n        a = a.toLowerCase();\n        b = b.toLowerCase();\n        return a === b ? 0 : (a > b ? 1 : -1);\n    });\n};\n\n/**\n * obj转为string\n * @param  {Object}  obj                需要转的对象，必须\n * @param  {Boolean} lowerCaseKey       key是否转为小写，默认false，非必须\n * @return {String}  data               返回字符串\n */\nvar obj2str = function (obj, lowerCaseKey) {\n    var i, key, val;\n    var list = [];\n    var keyList = getObjectKeys(obj);\n    for (i = 0; i < keyList.length; i++) {\n        key = keyList[i];\n        val = (obj[key] === undefined || obj[key] === null) ? '' : ('' + obj[key]);\n        key = lowerCaseKey? camSafeUrlEncode(key).toLowerCase() : camSafeUrlEncode(key);\n        val = camSafeUrlEncode(val) || '';\n        list.push(key + '=' + val)\n    }\n    return list.join('&');\n};\n\n\n// 可以签入签名的headers\nvar signHeaders = ['content-disposition', 'content-encoding', 'content-length', 'content-md5',\n    'expect', 'host', 'if-match', 'if-modified-since', 'if-none-match', 'if-unmodified-since',\n    'origin', 'range', 'response-cache-control', 'response-content-disposition', 'response-content-encoding',\n    'response-content-language', 'response-content-type', 'response-expires', 'transfer-encoding', 'versionid'];\n\nvar getSignHeaderObj = function (headers) {\n    var signHeaderObj = {};\n    for (var i in headers) {\n        var key = i.toLowerCase();\n        if (key.indexOf('x-cos-') > -1 || signHeaders.indexOf(key) > -1) {\n            signHeaderObj[i] = headers[i];\n        }\n    }\n    return signHeaderObj;\n}\n\n//测试用的key后面可以去掉\nvar getAuth = function (opt) {\n    opt = opt || {};\n\n    var SecretId = opt.SecretId;\n    var SecretKey = opt.SecretKey;\n    var KeyTime = opt.KeyTime;\n    var method = (opt.method || opt.Method || 'get').toLowerCase();\n    var queryParams = clone(opt.Query || opt.params || {});\n    var headers = getSignHeaderObj(clone(opt.Headers || opt.headers || {}));\n\n    var Key = opt.Key || '';\n    var pathname;\n    if (opt.UseRawKey) {\n        pathname = opt.Pathname || opt.pathname || '/' + Key;\n    } else {\n        pathname = opt.Pathname || opt.pathname || Key;\n        pathname.indexOf('/') !== 0 && (pathname = '/' + pathname);\n    }\n\n    // 如果有传入存储桶，那么签名默认加 Host 参与计算，避免跨桶访问\n    if (!headers.Host && !headers.host && opt.Bucket && opt.Region) headers.Host = opt.Bucket + '.cos.' + opt.Region + '.myqcloud.com';\n\n    if (!SecretId) throw new Error('missing param SecretId');\n    if (!SecretKey) throw new Error('missing param SecretKey');\n\n    // 签名有效起止时间\n    var now = Math.round(getSkewTime(opt.SystemClockOffset) / 1000) - 1;\n    var exp = now;\n\n    var Expires = opt.Expires || opt.expires;\n    if (Expires === undefined) {\n        exp += 900; // 签名过期时间为当前 + 900s\n    } else {\n        exp += (Expires * 1) || 0;\n    }\n\n    // 要用到的 Authorization 参数列表\n    var qSignAlgorithm = 'sha1';\n    var qAk = SecretId;\n    var qSignTime = KeyTime || now + ';' + exp;\n    var qKeyTime = KeyTime || now + ';' + exp;\n    var qHeaderList = getObjectKeys(headers, true).join(';').toLowerCase();\n    var qUrlParamList = getObjectKeys(queryParams, true).join(';').toLowerCase();\n\n    // 签名算法说明文档：https://www.qcloud.com/document/product/436/7778\n    // 步骤一：计算 SignKey\n    var signKey = CryptoJS.HmacSHA1(qKeyTime, SecretKey).toString();\n\n    // 步骤二：构成 FormatString\n    var formatString = [method, pathname, util.obj2str(queryParams, true), util.obj2str(headers, true), ''].join('\\n');\n\n    // 步骤三：计算 StringToSign\n    var stringToSign = ['sha1', qSignTime, CryptoJS.SHA1(formatString).toString(), ''].join('\\n');\n\n    // 步骤四：计算 Signature\n    var qSignature = CryptoJS.HmacSHA1(stringToSign, signKey).toString();\n\n    // 步骤五：构造 Authorization\n    var authorization = [\n        'q-sign-algorithm=' + qSignAlgorithm,\n        'q-ak=' + qAk,\n        'q-sign-time=' + qSignTime,\n        'q-key-time=' + qKeyTime,\n        'q-header-list=' + qHeaderList,\n        'q-url-param-list=' + qUrlParamList,\n        'q-signature=' + qSignature\n    ].join('&');\n\n    return authorization;\n\n};\n\nvar readIntBE = function (chunk, size, offset) {\n    var bytes = size / 8;\n    var buf = chunk.slice(offset, offset + bytes);\n    new Uint8Array(buf).reverse();\n    return new ({8: Uint8Array, 16: Uint16Array, 32: Uint32Array})[size](buf)[0];\n};\nvar buf2str = function (chunk, start, end, isUtf8) {\n    var buf = chunk.slice(start, end);\n    var str = '';\n    new Uint8Array(buf).forEach(function (charCode) {\n        str += String.fromCharCode(charCode)\n    });\n    if (isUtf8) str = decodeURIComponent(escape(str));\n    return str;\n};\nvar parseSelectPayload = function (chunk) {\n    var header = {};\n    var body = buf2str(chunk);\n    var result = {records:[]};\n    while (chunk.byteLength) {\n        var totalLength = readIntBE(chunk, 32, 0);\n        var headerLength = readIntBE(chunk, 32, 4);\n        var payloadRestLength = totalLength - headerLength - 16;\n        var offset = 0;\n        var content;\n        chunk = chunk.slice(12);\n        // 获取 Message 的 header 信息\n        while (offset < headerLength) {\n            var headerNameLength = readIntBE(chunk, 8, offset);\n            var headerName = buf2str(chunk, offset + 1, offset + 1 + headerNameLength);\n            var headerValueLength = readIntBE(chunk, 16, offset + headerNameLength + 2);\n            var headerValue = buf2str(chunk, offset + headerNameLength + 4, offset + headerNameLength + 4 + headerValueLength);\n            header[headerName] = headerValue;\n            offset += headerNameLength + 4 + headerValueLength;\n        }\n        if (header[':event-type'] === 'Records') {\n            content = buf2str(chunk, offset, offset + payloadRestLength, true);\n            result.records.push(content);\n        } else if (header[':event-type'] === 'Stats') {\n            content = buf2str(chunk, offset, offset + payloadRestLength, true);\n            result.stats = util.xml2json(content).Stats;\n        } else if (header[':event-type'] === 'error') {\n            var errCode = header[':error-code'];\n            var errMessage = header[':error-message'];\n            var err = new Error(errMessage);\n            err.message = errMessage;\n            err.name = err.code = errCode;\n            result.error = err;\n        } else if (['Progress', 'Continuation', 'End'].includes(header[':event-type'])) {\n            // do nothing\n        }\n        chunk = chunk.slice(offset + payloadRestLength + 4);\n    }\n    return {\n        payload: result.records.join(''),\n        body: body,\n    };\n};\n\nvar getSourceParams = function (source) {\n    var parser = this.options.CopySourceParser;\n    if (parser) return parser(source);\n    var m = source.match(/^([^.]+-\\d+)\\.cos(v6|-cdc)?\\.([^.]+)\\.myqcloud\\.com\\/(.+)$/);\n    if (!m) return null;\n    return { Bucket: m[1], Region: m[3], Key: m[4] };\n};\n\nvar noop = function () {\n\n};\n\n// 清除对象里值为的 undefined 或 null 的属性\nvar clearKey = function (obj) {\n    var retObj = {};\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key) && obj[key] !== undefined && obj[key] !== null) {\n            retObj[key] = obj[key];\n        }\n    }\n    return retObj;\n};\n\nvar readAsBinaryString = function (blob, callback) {\n    var readFun;\n    var fr = new FileReader();\n    if (FileReader.prototype.readAsBinaryString) {\n        readFun = FileReader.prototype.readAsBinaryString;\n        fr.onload = function () {\n            callback(this.result);\n        };\n    } else if (FileReader.prototype.readAsArrayBuffer) { // 在 ie11 添加 readAsBinaryString 兼容\n        readFun = function (fileData) {\n            var binary = \"\";\n            var pt = this;\n            var reader = new FileReader();\n            reader.onload = function (e) {\n                var bytes = new Uint8Array(reader.result);\n                var length = bytes.byteLength;\n                for (var i = 0; i < length; i++) {\n                    binary += String.fromCharCode(bytes[i]);\n                }\n                callback(binary);\n            };\n            reader.readAsArrayBuffer(fileData);\n        };\n    } else {\n        console.error('FileReader not support readAsBinaryString');\n    }\n    readFun.call(fr, blob);\n};\n\nvar fileSliceNeedCopy = (function () {\n    var compareVersion = function(a, b) {\n        a = a.split('.');\n        b = b.split('.');\n        for (var i = 0; i < b.length; i++) {\n            if (a[i] !== b[i]) {\n                return parseInt(a[i]) > parseInt(b[i]) ? 1 : -1;\n            }\n        }\n        return 0;\n    };\n    var check = function (ua) {\n        if (!ua) return false;\n        var ChromeVersion = (ua.match(/Chrome\\/([.\\d]+)/) || [])[1];\n        var QBCoreVersion = (ua.match(/QBCore\\/([.\\d]+)/) || [])[1];\n        var QQBrowserVersion = (ua.match(/QQBrowser\\/([.\\d]+)/) || [])[1];\n        var need = ChromeVersion && compareVersion(ChromeVersion, '53.0.2785.116') < 0\n            && QBCoreVersion && compareVersion(QBCoreVersion, '3.53.991.400') < 0\n            && QQBrowserVersion && compareVersion(QQBrowserVersion, '9.0.2524.400') <= 0 || false;\n        return need;\n    };\n    return check(typeof navigator !== 'undefined' && navigator.userAgent);\n})();\n\n// 获取文件分片\nvar fileSlice = function (file, start, end, isUseToUpload, callback) {\n    var blob;\n    if (file.slice) {\n        blob = file.slice(start, end);\n    } else if (file.mozSlice) {\n        blob = file.mozSlice(start, end);\n    } else if (file.webkitSlice) {\n        blob = file.webkitSlice(start, end);\n    }\n    if (isUseToUpload && fileSliceNeedCopy) {\n        var reader = new FileReader();\n        reader.onload = function (e) {\n            blob = null;\n            callback(new Blob([reader.result]));\n        };\n        reader.readAsArrayBuffer(blob);\n    } else {\n        callback(blob);\n    }\n};\n\n// 获取文件内容的 MD5\nvar getBodyMd5 = function (UploadCheckContentMd5, Body, callback, onProgress) {\n    callback = callback || noop;\n    if (UploadCheckContentMd5) {\n        if (typeof Body === 'string') {\n            callback(util.md5(Body, true));\n        } else if (Blob && Body instanceof Blob) {\n            util.getFileMd5(Body, function (err, md5) {\n                callback(md5);\n            }, onProgress);\n        } else {\n            callback();\n        }\n    } else {\n        callback();\n    }\n};\n\n// 获取文件 md5 值\nvar md5ChunkSize = 1024 * 1024;\nvar getFileMd5 = function (blob, callback, onProgress) {\n    var size = blob.size;\n    var loaded = 0;\n    var md5ctx = md5.getCtx();\n    var next = function (start) {\n        if (start >= size) {\n            var hash = md5ctx.digest('hex');\n            callback(null, hash);\n            return;\n        }\n        var end = Math.min(size, start + md5ChunkSize);\n        util.fileSlice(blob, start, end, false, function (chunk) {\n            readAsBinaryString(chunk, function (content) {\n                chunk = null;\n                md5ctx = md5ctx.update(content, true);\n                loaded += content.length;\n                content = null;\n                if (onProgress) onProgress({loaded: loaded, total: size, percent: Math.round(loaded / size * 10000) / 10000});\n                next(start + md5ChunkSize);\n            });\n        });\n    };\n    next(0);\n};\n\nfunction clone(obj) {\n    return map(obj, function (v) {\n        return typeof v === 'object' && v !== null ? clone(v) : v;\n    });\n}\n\nfunction attr(obj, name, defaultValue) {\n    return obj && name in obj ? obj[name] : defaultValue;\n}\n\nfunction extend(target, source) {\n    each(source, function (val, key) {\n        target[key] = source[key];\n    });\n    return target;\n}\n\nfunction isArray(arr) {\n    return arr instanceof Array;\n}\n\nfunction isInArray(arr, item) {\n    var flag = false;\n    for (var i = 0; i < arr.length; i++) {\n        if (item === arr[i]) {\n            flag = true;\n            break;\n        }\n    }\n    return flag;\n}\n\nfunction makeArray(arr) {\n    return isArray(arr) ? arr : [arr];\n}\n\nfunction each(obj, fn) {\n    for (var i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            fn(obj[i], i);\n        }\n    }\n}\n\nfunction map(obj, fn) {\n    var o = isArray(obj) ? [] : {};\n    for (var i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            o[i] = fn(obj[i], i);\n        }\n    }\n    return o;\n}\n\nfunction filter(obj, fn) {\n    var iaArr = isArray(obj);\n    var o = iaArr ? [] : {};\n    for (var i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            if (fn(obj[i], i)) {\n                if (iaArr) {\n                    o.push(obj[i]);\n                } else {\n                    o[i] = obj[i];\n                }\n            }\n        }\n    }\n    return o;\n}\n\nvar binaryBase64 = function (str) {\n    var i, len, char, res = '';\n    for (i = 0, len = str.length / 2; i < len; i++) {\n        char = parseInt(str[i * 2] + str[i * 2 + 1], 16);\n        res += String.fromCharCode(char);\n    }\n    return btoa(res);\n};\nvar uuid = function () {\n    var S4 = function () {\n        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n    };\n    return (S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4());\n};\n\nvar hasMissingParams = function (apiName, params) {\n    var Bucket = params.Bucket;\n    var Region = params.Region;\n    var Key = params.Key;\n    var Domain = this.options.Domain;\n    var checkBucket = !Domain || Domain.indexOf('{Bucket}') > -1;\n    var checkRegion = !Domain || Domain.indexOf('{Region}') > -1;\n    if (apiName.indexOf('Bucket') > -1 || apiName === 'deleteMultipleObject' || apiName === 'multipartList' || apiName === 'listObjectVersions') {\n        if (checkBucket && !Bucket) return 'Bucket';\n        if (checkRegion && !Region) return 'Region';\n    } else if (apiName.indexOf('Object') > -1 || apiName.indexOf('multipart') > -1 || apiName === 'sliceUploadFile' || apiName === 'abortUploadTask') {\n        if (checkBucket && !Bucket) return 'Bucket';\n        if (checkRegion && !Region) return 'Region';\n        if (!Key) return 'Key';\n    }\n    return false;\n};\n\nvar formatParams = function (apiName, params) {\n\n    // 复制参数对象\n    params = extend({}, params);\n\n    // 统一处理 Headers\n    if (apiName !== 'getAuth' && apiName !== 'getV4Auth' && apiName !== 'getObjectUrl') {\n        var Headers = params.Headers || {};\n        if (params && typeof params === 'object') {\n            (function () {\n                for (var key in params) {\n                    if (params.hasOwnProperty(key) && key.indexOf('x-cos-') > -1) {\n                        Headers[key] = params[key];\n                    }\n                }\n            })();\n\n            var headerMap = {\n                // params headers\n                'x-cos-mfa': 'MFA',\n                'Content-MD5': 'ContentMD5',\n                'Content-Length': 'ContentLength',\n                'Content-Type': 'ContentType',\n                'Expect': 'Expect',\n                'Expires': 'Expires',\n                'Cache-Control': 'CacheControl',\n                'Content-Disposition': 'ContentDisposition',\n                'Content-Encoding': 'ContentEncoding',\n                'Range': 'Range',\n                'If-Modified-Since': 'IfModifiedSince',\n                'If-Unmodified-Since': 'IfUnmodifiedSince',\n                'If-Match': 'IfMatch',\n                'If-None-Match': 'IfNoneMatch',\n                'x-cos-copy-source': 'CopySource',\n                'x-cos-copy-source-Range': 'CopySourceRange',\n                'x-cos-metadata-directive': 'MetadataDirective',\n                'x-cos-copy-source-If-Modified-Since': 'CopySourceIfModifiedSince',\n                'x-cos-copy-source-If-Unmodified-Since': 'CopySourceIfUnmodifiedSince',\n                'x-cos-copy-source-If-Match': 'CopySourceIfMatch',\n                'x-cos-copy-source-If-None-Match': 'CopySourceIfNoneMatch',\n                'x-cos-acl': 'ACL',\n                'x-cos-grant-read': 'GrantRead',\n                'x-cos-grant-write': 'GrantWrite',\n                'x-cos-grant-full-control': 'GrantFullControl',\n                'x-cos-grant-read-acp': 'GrantReadAcp',\n                'x-cos-grant-write-acp': 'GrantWriteAcp',\n                'x-cos-storage-class': 'StorageClass',\n                'x-cos-traffic-limit': 'TrafficLimit',\n                'x-cos-mime-limit': 'MimeLimit',\n                // SSE-C\n                'x-cos-server-side-encryption-customer-algorithm': 'SSECustomerAlgorithm',\n                'x-cos-server-side-encryption-customer-key': 'SSECustomerKey',\n                'x-cos-server-side-encryption-customer-key-MD5': 'SSECustomerKeyMD5',\n                // SSE-COS、SSE-KMS\n                'x-cos-server-side-encryption': 'ServerSideEncryption',\n                'x-cos-server-side-encryption-cos-kms-key-id': 'SSEKMSKeyId',\n                'x-cos-server-side-encryption-context': 'SSEContext',\n            };\n            util.each(headerMap, function (paramKey, headerKey) {\n                if (params[paramKey] !== undefined) {\n                    Headers[headerKey] = params[paramKey];\n                }\n            });\n\n            params.Headers = clearKey(Headers);\n        }\n    }\n\n    return params;\n};\n\nvar apiWrapper = function (apiName, apiFn) {\n    return function (params, callback) {\n\n        var self = this;\n\n        // 处理参数\n        if (typeof params === 'function') {\n            callback = params;\n            params = {};\n        }\n\n        // 整理参数格式\n        params = formatParams(apiName, params);\n\n        // 代理回调函数\n        var formatResult = function (result) {\n            if (result && result.headers) {\n                result.headers['x-cos-request-id'] && (result.RequestId = result.headers['x-cos-request-id']);\n                result.headers['x-cos-version-id'] && (result.VersionId = result.headers['x-cos-version-id']);\n                result.headers['x-cos-delete-marker'] && (result.DeleteMarker = result.headers['x-cos-delete-marker']);\n            }\n            return result;\n        };\n        var _callback = function (err, data) {\n            callback && callback(formatResult(err), formatResult(data));\n        };\n\n        var checkParams = function () {\n            if (apiName !== 'getService' && apiName !== 'abortUploadTask') {\n                // 判断参数是否完整\n                var missingResult = hasMissingParams.call(self, apiName, params)\n                if (missingResult) {\n                    return 'missing param ' + missingResult;\n                }\n                // 判断 region 格式\n                if (params.Region) {\n                    if (self.options.CompatibilityMode) {\n                        if (!/^([a-z\\d-.]+)$/.test(params.Region)) {\n                            return 'Region format error.';\n                        }\n                    } else {\n                        if (params.Region.indexOf('cos.') > -1) {\n                            return 'param Region should not be start with \"cos.\"';\n                        } else if (!/^([a-z\\d-]+)$/.test(params.Region)) {\n                            return 'Region format error.';\n                        }\n                    }\n                    // 判断 region 格式\n                    if (!self.options.CompatibilityMode\n                        && params.Region.indexOf('-') === -1\n                        && params.Region !== 'yfb'\n                        && params.Region !== 'default'\n                        && params.Region !== 'accelerate' ) {\n                        console.warn('warning: param Region format error, find help here: https://cloud.tencent.com/document/product/436/6224');\n                    }\n                }\n                // 兼容不带 AppId 的 Bucket\n                if (params.Bucket) {\n                    if (!/^([a-z\\d-]+)-(\\d+)$/.test(params.Bucket)) {\n                        if (params.AppId) {\n                            params.Bucket = params.Bucket + '-' + params.AppId;\n                        } else if (self.options.AppId) {\n                            params.Bucket = params.Bucket + '-' + self.options.AppId;\n                        } else {\n                            return 'Bucket should format as \"test-1250000000\".';\n                        }\n                    }\n                    if (params.AppId) {\n                        console.warn('warning: AppId has been deprecated, Please put it at the end of parameter Bucket(E.g Bucket:\"test-1250000000\" ).');\n                        delete params.AppId;\n                    }\n                }\n                // 如果 Key 是 / 开头，强制去掉第一个 /\n                if (!self.options.UseRawKey && params.Key && params.Key.substr(0, 1) === '/') {\n                    params.Key = params.Key.substr(1);\n                }\n            }\n        };\n\n        var errMsg = checkParams();\n        var isSync = apiName === 'getAuth' || apiName === 'getObjectUrl';\n        if (window.Promise && !isSync && !callback) {\n            return new Promise(function (resolve, reject) {\n                callback = function (err, data) {\n                    err ? reject(err) : resolve(data);\n                };\n                if (errMsg) return _callback(util.error(new Error(errMsg)));\n                apiFn.call(self, params, _callback);\n            });\n        } else {\n            if (errMsg) return _callback(util.error(new Error(errMsg)));\n            var res = apiFn.call(self, params, _callback);\n            if (isSync) return res;\n        }\n    }\n};\n\nvar throttleOnProgress = function (total, onProgress) {\n    var self = this;\n    var size0 = 0;\n    var size1 = 0;\n    var time0 = Date.now();\n    var time1;\n    var timer;\n\n    function update() {\n        timer = 0;\n        if (onProgress && (typeof onProgress === 'function')) {\n            time1 = Date.now();\n            var speed = Math.max(0, Math.round((size1 - size0) / ((time1 - time0) / 1000) * 100) / 100) || 0;\n            var percent;\n            if (size1 === 0 && total === 0) {\n                percent = 1;\n            } else {\n                percent = Math.floor(size1 / total * 100) / 100 || 0;\n            }\n            time0 = time1;\n            size0 = size1;\n            try {\n                onProgress({loaded: size1, total: total, speed: speed, percent: percent});\n            } catch (e) {\n            }\n        }\n    }\n\n    return function (info, immediately) {\n        if (info) {\n            size1 = info.loaded;\n            total = info.total;\n        }\n        if (immediately) {\n            clearTimeout(timer);\n            update();\n        } else {\n            if (timer) return;\n            timer = setTimeout(update, self.options.ProgressInterval);\n        }\n    };\n};\n\nvar getFileSize = function (api, params, callback) {\n    var size;\n    if (typeof params.Body === 'string') {\n        params.Body = new Blob([params.Body], {type: 'text/plain'});\n    } else if (params.Body instanceof ArrayBuffer) {\n        params.Body = new Blob([params.Body]);\n    }\n    if ((params.Body && (params.Body instanceof Blob || params.Body.toString() === '[object File]' || params.Body.toString() === '[object Blob]'))) {\n        size = params.Body.size;\n    } else {\n        callback(util.error(new Error('params body format error, Only allow File|Blob|String.')));\n        return;\n    }\n    params.ContentLength = size;\n    callback(null, size);\n};\n\n// 获取调正的时间戳\nvar getSkewTime = function (offset) {\n    return Date.now() + (offset || 0);\n};\n\n\nvar error = function (err, opt) {\n    var sourceErr = err;\n    err.message = err.message || null;\n\n    if (typeof opt === 'string') {\n        err.error = opt;\n        err.message = opt;\n    } else if (typeof opt === 'object' && opt !== null) {\n        extend(err, opt);\n        if (opt.code || opt.name) err.code = opt.code || opt.name;\n        if (opt.message) err.message = opt.message;\n        if (opt.stack) err.stack = opt.stack;\n    }\n\n    if (typeof Object.defineProperty === 'function') {\n        Object.defineProperty(err, 'name', {writable: true, enumerable: false});\n        Object.defineProperty(err, 'message', {enumerable: true});\n    }\n\n    err.name = opt && opt.name || err.name || err.code || 'Error';\n    if (!err.code) err.code = err.name;\n    if (!err.error) err.error = clone(sourceErr); // 兼容老的错误格式\n\n    return err;\n}\n\nvar isNode = function () {\n    return typeof window !== 'object' && typeof process === 'object' && typeof require === 'function';\n}\n\nvar isCIHost = function(url) {\n    return /^https?:\\/\\/([^/]+\\.)?ci\\.[^/]+/.test(url);\n}\n\nvar util = {\n    noop: noop,\n    formatParams: formatParams,\n    apiWrapper: apiWrapper,\n    xml2json: xml2json,\n    json2xml: json2xml,\n    md5: md5,\n    clearKey: clearKey,\n    fileSlice: fileSlice,\n    getBodyMd5: getBodyMd5,\n    getFileMd5: getFileMd5,\n    binaryBase64: binaryBase64,\n    extend: extend,\n    isArray: isArray,\n    isInArray: isInArray,\n    makeArray: makeArray,\n    each: each,\n    map: map,\n    filter: filter,\n    clone: clone,\n    attr: attr,\n    uuid: uuid,\n    camSafeUrlEncode: camSafeUrlEncode,\n    throttleOnProgress: throttleOnProgress,\n    getFileSize: getFileSize,\n    getSkewTime: getSkewTime,\n    error: error,\n    obj2str: obj2str,\n    getAuth: getAuth,\n    parseSelectPayload: parseSelectPayload,\n    getSourceParams: getSourceParams,\n    isBrowser: true,\n    isNode: isNode,\n    isCIHost: isCIHost,\n};\n\nmodule.exports = util;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}