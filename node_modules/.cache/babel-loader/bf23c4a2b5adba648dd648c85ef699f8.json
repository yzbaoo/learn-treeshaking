{"ast":null,"code":"var session = require('./session');\n\nvar util = require('./util');\n\nvar originApiMap = {};\n\nvar transferToTaskMethod = function (apiMap, apiName) {\n  originApiMap[apiName] = apiMap[apiName];\n\n  apiMap[apiName] = function (params, callback) {\n    if (params.SkipTask) {\n      originApiMap[apiName].call(this, params, callback);\n    } else {\n      this._addTask(apiName, params, callback);\n    }\n  };\n};\n\nvar initTask = function (cos) {\n  var queue = [];\n  var tasks = {};\n  var uploadingFileCount = 0;\n  var nextUploadIndex = 0; // 接口返回简略的任务信息\n\n  var formatTask = function (task) {\n    var t = {\n      id: task.id,\n      Bucket: task.Bucket,\n      Region: task.Region,\n      Key: task.Key,\n      FilePath: task.FilePath,\n      state: task.state,\n      loaded: task.loaded,\n      size: task.size,\n      speed: task.speed,\n      percent: task.percent,\n      hashPercent: task.hashPercent,\n      error: task.error\n    };\n    if (task.FilePath) t.FilePath = task.FilePath;\n    if (task._custom) t._custom = task._custom; // 控制台使用\n\n    return t;\n  };\n\n  var emitListUpdate = function () {\n    var timer;\n\n    var emit = function () {\n      timer = 0;\n      cos.emit('task-list-update', {\n        list: util.map(queue, formatTask)\n      });\n      cos.emit('list-update', {\n        list: util.map(queue, formatTask)\n      });\n    };\n\n    return function () {\n      if (!timer) timer = setTimeout(emit);\n    };\n  }();\n\n  var clearQueue = function () {\n    if (queue.length <= cos.options.UploadQueueSize) return;\n\n    for (var i = 0; i < nextUploadIndex && // 小于当前操作的 index 才清理\n    i < queue.length && // 大于队列才清理\n    queue.length > cos.options.UploadQueueSize // 如果还太多，才继续清理\n    ;) {\n      var isActive = queue[i].state === 'waiting' || queue[i].state === 'checking' || queue[i].state === 'uploading';\n\n      if (!queue[i] || !isActive) {\n        tasks[queue[i].id] && delete tasks[queue[i].id];\n        queue.splice(i, 1);\n        nextUploadIndex--;\n      } else {\n        i++;\n      }\n    }\n\n    emitListUpdate();\n  };\n\n  var startNextTask = function () {\n    // 检查是否允许增加执行进程\n    if (uploadingFileCount >= cos.options.FileParallelLimit) return; // 跳过不可执行的任务\n\n    while (queue[nextUploadIndex] && queue[nextUploadIndex].state !== 'waiting') nextUploadIndex++; // 检查是否已遍历结束\n\n\n    if (nextUploadIndex >= queue.length) return; // 上传该遍历到的任务\n\n    var task = queue[nextUploadIndex];\n    nextUploadIndex++;\n    uploadingFileCount++;\n    task.state = 'checking';\n    task.params.onTaskStart && task.params.onTaskStart(formatTask(task));\n    !task.params.UploadData && (task.params.UploadData = {});\n    var apiParams = util.formatParams(task.api, task.params);\n    originApiMap[task.api].call(cos, apiParams, function (err, data) {\n      if (!cos._isRunningTask(task.id)) return;\n\n      if (task.state === 'checking' || task.state === 'uploading') {\n        task.state = err ? 'error' : 'success';\n        err && (task.error = err);\n        uploadingFileCount--;\n        emitListUpdate();\n        startNextTask();\n        task.callback && task.callback(err, data);\n\n        if (task.state === 'success') {\n          if (task.params) {\n            delete task.params.UploadData;\n            delete task.params.Body;\n            delete task.params;\n          }\n\n          delete task.callback;\n        }\n      }\n\n      clearQueue();\n    });\n    emitListUpdate(); // 异步执行下一个任务\n\n    setTimeout(startNextTask);\n  };\n\n  var killTask = function (id, switchToState) {\n    var task = tasks[id];\n    if (!task) return;\n    var waiting = task && task.state === 'waiting';\n    var running = task && (task.state === 'checking' || task.state === 'uploading');\n\n    if (switchToState === 'canceled' && task.state !== 'canceled' || switchToState === 'paused' && waiting || switchToState === 'paused' && running) {\n      if (switchToState === 'paused' && task.params.Body && typeof task.params.Body.pipe === 'function') {\n        console.error('stream not support pause');\n        return;\n      }\n\n      task.state = switchToState;\n      cos.emit('inner-kill-task', {\n        TaskId: id,\n        toState: switchToState\n      });\n\n      try {\n        var UploadId = task && task.params && task.params.UploadData.UploadId;\n      } catch (e) {}\n\n      if (switchToState === 'canceled' && UploadId) session.removeUsing(UploadId);\n      emitListUpdate();\n\n      if (running) {\n        uploadingFileCount--;\n        startNextTask();\n      }\n\n      if (switchToState === 'canceled') {\n        if (task.params) {\n          delete task.params.UploadData;\n          delete task.params.Body;\n          delete task.params;\n        }\n\n        delete task.callback;\n      }\n    }\n\n    clearQueue();\n  };\n\n  cos._addTasks = function (taskList) {\n    util.each(taskList, function (task) {\n      cos._addTask(task.api, task.params, task.callback, true);\n    });\n    emitListUpdate();\n  };\n\n  var isTaskReadyWarning = true;\n\n  cos._addTask = function (api, params, callback, ignoreAddEvent) {\n    // 复制参数对象\n    params = util.formatParams(api, params); // 生成 id\n\n    var id = util.uuid();\n    params.TaskId = id;\n    params.onTaskReady && params.onTaskReady(id);\n\n    if (params.TaskReady) {\n      params.TaskReady(id);\n      isTaskReadyWarning && console.warn('warning: Param \"TaskReady\" has been deprecated. Please use \"onTaskReady\" instead.');\n      isTaskReadyWarning = false;\n    }\n\n    var task = {\n      // env\n      params: params,\n      callback: callback,\n      api: api,\n      index: queue.length,\n      // task\n      id: id,\n      Bucket: params.Bucket,\n      Region: params.Region,\n      Key: params.Key,\n      FilePath: params.FilePath || '',\n      state: 'waiting',\n      loaded: 0,\n      size: 0,\n      speed: 0,\n      percent: 0,\n      hashPercent: 0,\n      error: null,\n      _custom: params._custom\n    };\n    var onHashProgress = params.onHashProgress;\n\n    params.onHashProgress = function (info) {\n      if (!cos._isRunningTask(task.id)) return;\n      task.hashPercent = info.percent;\n      onHashProgress && onHashProgress(info);\n      emitListUpdate();\n    };\n\n    var onProgress = params.onProgress;\n\n    params.onProgress = function (info) {\n      if (!cos._isRunningTask(task.id)) return;\n      task.state === 'checking' && (task.state = 'uploading');\n      task.loaded = info.loaded;\n      task.speed = info.speed;\n      task.percent = info.percent;\n      onProgress && onProgress(info);\n      emitListUpdate();\n    }; // 异步获取 filesize\n\n\n    util.getFileSize(api, params, function (err, size) {\n      // 开始处理上传\n      if (err) return callback(util.error(err)); // 如果获取大小出错，不加入队列\n      // 获取完文件大小再把任务加入队列\n\n      tasks[id] = task;\n      queue.push(task);\n      task.size = size;\n      !ignoreAddEvent && emitListUpdate();\n      startNextTask();\n      clearQueue();\n    });\n    return id;\n  };\n\n  cos._isRunningTask = function (id) {\n    var task = tasks[id];\n    return !!(task && (task.state === 'checking' || task.state === 'uploading'));\n  };\n\n  cos.getTaskList = function () {\n    return util.map(queue, formatTask);\n  };\n\n  cos.cancelTask = function (id) {\n    killTask(id, 'canceled');\n  };\n\n  cos.pauseTask = function (id) {\n    killTask(id, 'paused');\n  };\n\n  cos.restartTask = function (id) {\n    var task = tasks[id];\n\n    if (task && (task.state === 'paused' || task.state === 'error')) {\n      task.state = 'waiting';\n      emitListUpdate();\n      nextUploadIndex = Math.min(nextUploadIndex, task.index);\n      startNextTask();\n    }\n  };\n\n  cos.isUploadRunning = function () {\n    return uploadingFileCount || nextUploadIndex < queue.length;\n  };\n};\n\nmodule.exports.transferToTaskMethod = transferToTaskMethod;\nmodule.exports.init = initTask;","map":{"version":3,"names":["session","require","util","originApiMap","transferToTaskMethod","apiMap","apiName","params","callback","SkipTask","call","_addTask","initTask","cos","queue","tasks","uploadingFileCount","nextUploadIndex","formatTask","task","t","id","Bucket","Region","Key","FilePath","state","loaded","size","speed","percent","hashPercent","error","_custom","emitListUpdate","timer","emit","list","map","setTimeout","clearQueue","length","options","UploadQueueSize","i","isActive","splice","startNextTask","FileParallelLimit","onTaskStart","UploadData","apiParams","formatParams","api","err","data","_isRunningTask","Body","killTask","switchToState","waiting","running","pipe","console","TaskId","toState","UploadId","e","removeUsing","_addTasks","taskList","each","isTaskReadyWarning","ignoreAddEvent","uuid","onTaskReady","TaskReady","warn","index","onHashProgress","info","onProgress","getFileSize","push","getTaskList","cancelTask","pauseTask","restartTask","Math","min","isUploadRunning","module","exports","init"],"sources":["/Users/yzbaoo/Desktop/huohua/ilc-web-packages/node_modules/cos-js-sdk-v5/src/task.js"],"sourcesContent":["var session = require('./session');\nvar util = require('./util');\n\nvar originApiMap = {};\nvar transferToTaskMethod = function (apiMap, apiName) {\n    originApiMap[apiName] = apiMap[apiName];\n    apiMap[apiName] = function (params, callback) {\n        if (params.SkipTask) {\n            originApiMap[apiName].call(this, params, callback);\n        } else {\n            this._addTask(apiName, params, callback);\n        }\n    };\n};\n\nvar initTask = function (cos) {\n\n    var queue = [];\n    var tasks = {};\n    var uploadingFileCount = 0;\n    var nextUploadIndex = 0;\n\n    // 接口返回简略的任务信息\n    var formatTask = function (task) {\n        var t = {\n            id: task.id,\n            Bucket: task.Bucket,\n            Region: task.Region,\n            Key: task.Key,\n            FilePath: task.FilePath,\n            state: task.state,\n            loaded: task.loaded,\n            size: task.size,\n            speed: task.speed,\n            percent: task.percent,\n            hashPercent: task.hashPercent,\n            error: task.error,\n        };\n        if (task.FilePath) t.FilePath = task.FilePath;\n        if (task._custom) t._custom = task._custom; // 控制台使用\n        return t;\n    };\n\n    var emitListUpdate = (function () {\n        var timer;\n        var emit = function () {\n            timer = 0;\n            cos.emit('task-list-update', {list: util.map(queue, formatTask)});\n            cos.emit('list-update', {list: util.map(queue, formatTask)});\n        };\n        return function () {\n            if (!timer) timer = setTimeout(emit);\n        }\n    })();\n\n    var clearQueue = function () {\n        if (queue.length <= cos.options.UploadQueueSize) return;\n        for (var i = 0;\n             i < nextUploadIndex && // 小于当前操作的 index 才清理\n             i < queue.length && // 大于队列才清理\n             queue.length > cos.options.UploadQueueSize // 如果还太多，才继续清理\n            ;) {\n            var isActive = queue[i].state === 'waiting' || queue[i].state === 'checking' || queue[i].state === 'uploading';\n            if (!queue[i] || !isActive) {\n                tasks[queue[i].id] && (delete tasks[queue[i].id]);\n                queue.splice(i, 1);\n                nextUploadIndex--;\n            } else {\n                i++;\n            }\n        }\n        emitListUpdate();\n    };\n\n    var startNextTask = function () {\n        // 检查是否允许增加执行进程\n        if (uploadingFileCount >= cos.options.FileParallelLimit) return;\n        // 跳过不可执行的任务\n        while (queue[nextUploadIndex] && queue[nextUploadIndex].state !== 'waiting') nextUploadIndex++;\n        // 检查是否已遍历结束\n        if (nextUploadIndex >= queue.length) return;\n        // 上传该遍历到的任务\n        var task = queue[nextUploadIndex];\n        nextUploadIndex++;\n        uploadingFileCount++;\n        task.state = 'checking';\n        task.params.onTaskStart && task.params.onTaskStart(formatTask(task));\n        !task.params.UploadData && (task.params.UploadData = {});\n        var apiParams = util.formatParams(task.api, task.params);\n        originApiMap[task.api].call(cos, apiParams, function (err, data) {\n            if (!cos._isRunningTask(task.id)) return;\n            if (task.state === 'checking' || task.state === 'uploading') {\n                task.state = err ? 'error' : 'success';\n                err && (task.error = err);\n                uploadingFileCount--;\n                emitListUpdate();\n                startNextTask();\n                task.callback && task.callback(err, data);\n                if (task.state === 'success') {\n                    if (task.params) {\n                        delete task.params.UploadData;\n                        delete task.params.Body;\n                        delete task.params;\n                    }\n                    delete task.callback;\n                }\n            }\n            clearQueue();\n        });\n        emitListUpdate();\n        // 异步执行下一个任务\n        setTimeout(startNextTask);\n    };\n\n    var killTask = function (id, switchToState) {\n        var task = tasks[id];\n        if (!task) return;\n        var waiting = task && task.state === 'waiting';\n        var running = task && (task.state === 'checking' || task.state === 'uploading');\n        if (switchToState === 'canceled' && task.state !== 'canceled' ||\n            switchToState === 'paused' && waiting ||\n            switchToState === 'paused' && running) {\n            if (switchToState === 'paused' && task.params.Body && typeof task.params.Body.pipe === 'function') {\n                console.error('stream not support pause');\n                return;\n            }\n            task.state = switchToState;\n            cos.emit('inner-kill-task', {TaskId: id, toState: switchToState});\n            try {\n                var UploadId = task && task.params && task.params.UploadData.UploadId\n            } catch(e) {}\n            if (switchToState === 'canceled' && UploadId) session.removeUsing(UploadId)\n            emitListUpdate();\n            if (running) {\n                uploadingFileCount--;\n                startNextTask();\n            }\n            if (switchToState === 'canceled') {\n                if (task.params) {\n                    delete task.params.UploadData;\n                    delete task.params.Body;\n                    delete task.params;\n                }\n                delete task.callback;\n            }\n        }\n        clearQueue();\n    };\n\n    cos._addTasks = function (taskList) {\n        util.each(taskList, function (task) {\n            cos._addTask(task.api, task.params, task.callback, true);\n        });\n        emitListUpdate();\n    };\n\n    var isTaskReadyWarning = true;\n    cos._addTask = function (api, params, callback, ignoreAddEvent) {\n\n        // 复制参数对象\n        params = util.formatParams(api, params);\n\n        // 生成 id\n        var id = util.uuid();\n        params.TaskId = id;\n        params.onTaskReady && params.onTaskReady(id);\n        if (params.TaskReady) {\n            params.TaskReady(id);\n            isTaskReadyWarning && console.warn('warning: Param \"TaskReady\" has been deprecated. Please use \"onTaskReady\" instead.');\n            isTaskReadyWarning = false;\n        }\n\n        var task = {\n            // env\n            params: params,\n            callback: callback,\n            api: api,\n            index: queue.length,\n            // task\n            id: id,\n            Bucket: params.Bucket,\n            Region: params.Region,\n            Key: params.Key,\n            FilePath: params.FilePath || '',\n            state: 'waiting',\n            loaded: 0,\n            size: 0,\n            speed: 0,\n            percent: 0,\n            hashPercent: 0,\n            error: null,\n            _custom: params._custom,\n        };\n        var onHashProgress = params.onHashProgress;\n        params.onHashProgress = function (info) {\n            if (!cos._isRunningTask(task.id)) return;\n            task.hashPercent = info.percent;\n            onHashProgress && onHashProgress(info);\n            emitListUpdate();\n        };\n        var onProgress = params.onProgress;\n        params.onProgress = function (info) {\n            if (!cos._isRunningTask(task.id)) return;\n            task.state === 'checking' && (task.state = 'uploading');\n            task.loaded = info.loaded;\n            task.speed = info.speed;\n            task.percent = info.percent;\n            onProgress && onProgress(info);\n            emitListUpdate();\n        };\n\n        // 异步获取 filesize\n        util.getFileSize(api, params, function (err, size) {\n            // 开始处理上传\n            if (err) return callback(util.error(err)); // 如果获取大小出错，不加入队列\n            // 获取完文件大小再把任务加入队列\n            tasks[id] = task;\n            queue.push(task);\n            task.size = size;\n            !ignoreAddEvent && emitListUpdate();\n            startNextTask();\n            clearQueue();\n        });\n        return id;\n    };\n    cos._isRunningTask = function (id) {\n        var task = tasks[id];\n        return !!(task && (task.state === 'checking' || task.state === 'uploading'));\n    };\n    cos.getTaskList = function () {\n        return util.map(queue, formatTask);\n    };\n    cos.cancelTask = function (id) {\n        killTask(id, 'canceled');\n    };\n    cos.pauseTask = function (id) {\n        killTask(id, 'paused');\n    };\n    cos.restartTask = function (id) {\n        var task = tasks[id];\n        if (task && (task.state === 'paused' || task.state === 'error')) {\n            task.state = 'waiting';\n            emitListUpdate();\n            nextUploadIndex = Math.min(nextUploadIndex, task.index);\n            startNextTask();\n        }\n    };\n    cos.isUploadRunning = function () {\n        return uploadingFileCount || nextUploadIndex < queue.length;\n    };\n\n};\n\nmodule.exports.transferToTaskMethod = transferToTaskMethod;\nmodule.exports.init = initTask;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}