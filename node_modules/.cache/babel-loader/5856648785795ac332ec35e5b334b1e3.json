{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\";\nimport { sleep } from \"./utils/sleep\";\nimport { WaiterState } from \"./waiter\";\n\nvar exponentialBackoffWithJitter = function (minDelay, maxDelay, attemptCeiling, attempt) {\n  if (attempt > attemptCeiling) return maxDelay;\n  var delay = minDelay * Math.pow(2, attempt - 1);\n  return randomInRange(minDelay, delay);\n};\n\nvar randomInRange = function (min, max) {\n  return min + Math.random() * (max - min);\n};\n\nexport var runPolling = function (_a, input, acceptorChecks) {\n  var minDelay = _a.minDelay,\n      maxDelay = _a.maxDelay,\n      maxWaitTime = _a.maxWaitTime,\n      abortController = _a.abortController,\n      client = _a.client,\n      abortSignal = _a.abortSignal;\n  return __awaiter(void 0, void 0, void 0, function () {\n    var state, currentAttempt, waitUntil, attemptCeiling, delay, state_1;\n\n    var _b;\n\n    return __generator(this, function (_c) {\n      switch (_c.label) {\n        case 0:\n          return [4, acceptorChecks(client, input)];\n\n        case 1:\n          state = _c.sent().state;\n\n          if (state !== WaiterState.RETRY) {\n            return [2, {\n              state: state\n            }];\n          }\n\n          currentAttempt = 1;\n          waitUntil = Date.now() + maxWaitTime * 1000;\n          attemptCeiling = Math.log(maxDelay / minDelay) / Math.log(2) + 1;\n          _c.label = 2;\n\n        case 2:\n          if (!true) return [3, 5];\n\n          if (((_b = abortController === null || abortController === void 0 ? void 0 : abortController.signal) === null || _b === void 0 ? void 0 : _b.aborted) || (abortSignal === null || abortSignal === void 0 ? void 0 : abortSignal.aborted)) {\n            return [2, {\n              state: WaiterState.ABORTED\n            }];\n          }\n\n          delay = exponentialBackoffWithJitter(minDelay, maxDelay, attemptCeiling, currentAttempt);\n\n          if (Date.now() + delay * 1000 > waitUntil) {\n            return [2, {\n              state: WaiterState.TIMEOUT\n            }];\n          }\n\n          return [4, sleep(delay)];\n\n        case 3:\n          _c.sent();\n\n          return [4, acceptorChecks(client, input)];\n\n        case 4:\n          state_1 = _c.sent().state;\n\n          if (state_1 !== WaiterState.RETRY) {\n            return [2, {\n              state: state_1\n            }];\n          }\n\n          currentAttempt += 1;\n          return [3, 2];\n\n        case 5:\n          return [2];\n      }\n    });\n  });\n};","map":{"version":3,"names":["__awaiter","__generator","sleep","WaiterState","exponentialBackoffWithJitter","minDelay","maxDelay","attemptCeiling","attempt","delay","Math","pow","randomInRange","min","max","random","runPolling","_a","input","acceptorChecks","maxWaitTime","abortController","client","abortSignal","state","currentAttempt","waitUntil","state_1","_b","_c","label","sent","RETRY","Date","now","log","signal","aborted","ABORTED","TIMEOUT"],"sources":["/Users/yzbaoo/Desktop/huohua/ilc-web-packages/node_modules/@aws-sdk/util-waiter/dist-es/poller.js"],"sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { sleep } from \"./utils/sleep\";\nimport { WaiterState } from \"./waiter\";\nvar exponentialBackoffWithJitter = function (minDelay, maxDelay, attemptCeiling, attempt) {\n    if (attempt > attemptCeiling)\n        return maxDelay;\n    var delay = minDelay * Math.pow(2, (attempt - 1));\n    return randomInRange(minDelay, delay);\n};\nvar randomInRange = function (min, max) { return min + Math.random() * (max - min); };\nexport var runPolling = function (_a, input, acceptorChecks) {\n    var minDelay = _a.minDelay, maxDelay = _a.maxDelay, maxWaitTime = _a.maxWaitTime, abortController = _a.abortController, client = _a.client, abortSignal = _a.abortSignal;\n    return __awaiter(void 0, void 0, void 0, function () {\n        var state, currentAttempt, waitUntil, attemptCeiling, delay, state_1;\n        var _b;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0: return [4, acceptorChecks(client, input)];\n                case 1:\n                    state = (_c.sent()).state;\n                    if (state !== WaiterState.RETRY) {\n                        return [2, { state: state }];\n                    }\n                    currentAttempt = 1;\n                    waitUntil = Date.now() + maxWaitTime * 1000;\n                    attemptCeiling = Math.log(maxDelay / minDelay) / Math.log(2) + 1;\n                    _c.label = 2;\n                case 2:\n                    if (!true) return [3, 5];\n                    if (((_b = abortController === null || abortController === void 0 ? void 0 : abortController.signal) === null || _b === void 0 ? void 0 : _b.aborted) || (abortSignal === null || abortSignal === void 0 ? void 0 : abortSignal.aborted)) {\n                        return [2, { state: WaiterState.ABORTED }];\n                    }\n                    delay = exponentialBackoffWithJitter(minDelay, maxDelay, attemptCeiling, currentAttempt);\n                    if (Date.now() + delay * 1000 > waitUntil) {\n                        return [2, { state: WaiterState.TIMEOUT }];\n                    }\n                    return [4, sleep(delay)];\n                case 3:\n                    _c.sent();\n                    return [4, acceptorChecks(client, input)];\n                case 4:\n                    state_1 = (_c.sent()).state;\n                    if (state_1 !== WaiterState.RETRY) {\n                        return [2, { state: state_1 }];\n                    }\n                    currentAttempt += 1;\n                    return [3, 2];\n                case 5: return [2];\n            }\n        });\n    });\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}